6417649158a315f88e27e1b99733b7ba
"use strict";

var _interopRequireDefault = require("/home/mijanur/MYCODE/JAVASCRIPT/REACTJS/react-courses-master/Maximilian Schwarzmuller/21-testing/node_modules/@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("/home/mijanur/MYCODE/JAVASCRIPT/REACTJS/react-courses-master/Maximilian Schwarzmuller/21-testing/node_modules/@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.authCheckState = exports.setAuthRedirectPath = exports.auth = exports.checkAuthTimeout = exports.logout = exports.authFail = exports.authSuccess = exports.authStart = void 0;

var actionTypes = _interopRequireWildcard(require("./actionTypes"));

var _axios = _interopRequireDefault(require("axios"));

const authStart = () => {
  return {
    type: actionTypes.AUTH_START
  };
};

exports.authStart = authStart;

const authSuccess = (token, userId) => {
  return {
    type: actionTypes.AUTH_SUCCESS,
    idToken: token,
    userId: userId
  };
};

exports.authSuccess = authSuccess;

const authFail = error => {
  return {
    type: actionTypes.AUTH_FAIL,
    error: error
  };
};

exports.authFail = authFail;

const logout = () => {
  localStorage.removeItem('token');
  localStorage.removeItem('expirationDate');
  localStorage.removeItem('userId');
  return {
    type: actionTypes.AUTH_LOGOUT
  };
};

exports.logout = logout;

const checkAuthTimeout = expirationTime => {
  return dispatch => {
    setTimeout(() => {
      dispatch(logout());
    }, expirationTime * 1000);
  };
};

exports.checkAuthTimeout = checkAuthTimeout;

const auth = (email, password, isSignUp) => {
  return dispatch => {
    dispatch(authStart());
    const authData = {
      email: email,
      password: password,
      returnSecureToken: true
    };
    let url = 'https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyBnJo-bBVOZZa4T_SWTdYyerQPqiOYKIzo';

    if (!isSignUp) {
      url = 'https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyBnJo-bBVOZZa4T_SWTdYyerQPqiOYKIzo';
    }

    _axios.default.post(url, authData).then(response => {
      const expirationDate = new Date(new Date().getTime() + response.data.expiresIn * 1000);
      localStorage.setItem('token', response.data.idToken);
      localStorage.setItem('expirationDate', expirationDate);
      localStorage.setItem('userId', response.data.localId);
      dispatch(authSuccess(response.data.idToken, response.data.localId));
      dispatch(checkAuthTimeout(response.data.expiresIn));
    }).catch(error => {
      dispatch(authFail(error.response.data.error));
    });
  };
};

exports.auth = auth;

const setAuthRedirectPath = path => {
  return {
    type: actionTypes.SET_AUTH_REDIRECT_PATH,
    path: path
  };
};

exports.setAuthRedirectPath = setAuthRedirectPath;

const authCheckState = () => {
  return dispatch => {
    const token = localStorage.getItem('token');

    if (!token) {
      dispatch(logout());
    } else {
      const expirationDate = new Date(localStorage.getItem('expirationDate'));

      if (expirationDate <= new Date()) {
        dispatch(logout());
      } else {
        const userId = localStorage.getItem('userId');
        dispatch(authSuccess(token, userId)); // getting remaining time

        dispatch(checkAuthTimeout((expirationDate.getTime() - new Date().getTime()) / 1000));
      }
    }
  };
};

exports.authCheckState = authCheckState;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiYXV0aFN0YXJ0IiwidHlwZSIsImFjdGlvblR5cGVzIiwiQVVUSF9TVEFSVCIsImF1dGhTdWNjZXNzIiwidG9rZW4iLCJ1c2VySWQiLCJBVVRIX1NVQ0NFU1MiLCJpZFRva2VuIiwiYXV0aEZhaWwiLCJlcnJvciIsIkFVVEhfRkFJTCIsImxvZ291dCIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCJBVVRIX0xPR09VVCIsImNoZWNrQXV0aFRpbWVvdXQiLCJleHBpcmF0aW9uVGltZSIsImRpc3BhdGNoIiwic2V0VGltZW91dCIsImF1dGgiLCJlbWFpbCIsInBhc3N3b3JkIiwiaXNTaWduVXAiLCJhdXRoRGF0YSIsInJldHVyblNlY3VyZVRva2VuIiwidXJsIiwiYXhpb3MiLCJwb3N0IiwidGhlbiIsInJlc3BvbnNlIiwiZXhwaXJhdGlvbkRhdGUiLCJEYXRlIiwiZ2V0VGltZSIsImRhdGEiLCJleHBpcmVzSW4iLCJzZXRJdGVtIiwibG9jYWxJZCIsImNhdGNoIiwic2V0QXV0aFJlZGlyZWN0UGF0aCIsInBhdGgiLCJTRVRfQVVUSF9SRURJUkVDVF9QQVRIIiwiYXV0aENoZWNrU3RhdGUiLCJnZXRJdGVtIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUVPLE1BQU1BLFNBQVMsR0FBRyxNQUFNO0FBQzNCLFNBQU87QUFDSEMsSUFBQUEsSUFBSSxFQUFFQyxXQUFXLENBQUNDO0FBRGYsR0FBUDtBQUdILENBSk07Ozs7QUFNQSxNQUFNQyxXQUFXLEdBQUcsQ0FBQ0MsS0FBRCxFQUFRQyxNQUFSLEtBQW1CO0FBQzFDLFNBQU87QUFDSEwsSUFBQUEsSUFBSSxFQUFFQyxXQUFXLENBQUNLLFlBRGY7QUFFSEMsSUFBQUEsT0FBTyxFQUFFSCxLQUZOO0FBR0hDLElBQUFBLE1BQU0sRUFBRUE7QUFITCxHQUFQO0FBS0gsQ0FOTTs7OztBQVFBLE1BQU1HLFFBQVEsR0FBSUMsS0FBRCxJQUFXO0FBQy9CLFNB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Q3RDLEtBQUwsRUFBWTtBQUNSYSxNQUFBQSxRQUFRLENBQUNOLE1BQU0sRUFBUCxDQUFSO0FBQ0gsS0FGRCxNQUVPO0FBQ0gsWUFBTW1CLGNBQWMsR0FBRyxJQUFJQyxJQUFKLENBQVNuQixZQUFZLENBQUM4QixPQUFiLENBQXFCLGdCQUFyQixDQUFULENBQXZCOztBQUNBLFVBQUlaLGNBQWMsSUFBSSxJQUFJQyxJQUFKLEVBQXRCLEVBQWtDO0FBQzlCZCxRQUFBQSxRQUFRLENBQUNOLE1BQU0sRUFBUCxDQUFSO0FBQ0gsT0FGRCxNQUVPO0FBQ0gsY0FBTU4sTUFBTSxHQUFHTyxZQUFZLENBQUM4QixPQUFiLENBQXFCLFFBQXJCLENBQWY7QUFDQXpCLFFBQUFBLFFBQVEsQ0FBQ2QsV0FBVyxDQUFDQyxLQUFELEVBQVFDLE1BQVIsQ0FBWixDQUFSLENBRkcsQ0FHSDs7QUFDQVksUUFBQUEsUUFBUSxDQUFDRixnQkFBZ0IsQ0FBQyxDQUFDZSxjQUFjLENBQUNFLE9BQWYsS0FBMkIsSUFBSUQsSUFBSixHQUFXQyxPQUFYLEVBQTVCLElBQW9ELElBQXJELENBQWpCLENBQVI7QUFDSDtBQUNKO0FBQ0osR0FmRDtBQWdCSCxDQWpCTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFjdGlvblR5cGVzIGZyb20gJy4vYWN0aW9uVHlwZXMnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcblxuZXhwb3J0IGNvbnN0IGF1dGhTdGFydCA9ICgpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBhY3Rpb25UeXBlcy5BVVRIX1NUQVJUXG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGF1dGhTdWNjZXNzID0gKHRva2VuLCB1c2VySWQpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBhY3Rpb25UeXBlcy5BVVRIX1NVQ0NFU1MsXG4gICAgICAgIGlkVG9rZW46IHRva2VuLFxuICAgICAgICB1c2VySWQ6IHVzZXJJZFxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGF1dGhGYWlsID0gKGVycm9yKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogYWN0aW9uVHlwZXMuQVVUSF9GQUlMLFxuICAgICAgICBlcnJvcjogZXJyb3JcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgbG9nb3V0ID0gKCkgPT4ge1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdleHBpcmF0aW9uRGF0ZScpO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VySWQnKTtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBhY3Rpb25UeXBlcy5BVVRIX0xPR09VVFxuICAgIH07XG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tBdXRoVGltZW91dCA9IChleHBpcmF0aW9uVGltZSkgPT4ge1xuICAgIHJldHVybiAoZGlzcGF0Y2gpID0+IHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBkaXNwYXRjaChsb2dvdXQoKSlcbiAgICAgICAgfSwgZXhwaXJhdGlvblRpbWUgKiAxMDAwKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBhdXRoID0gKGVtYWlsLCBwYXNzd29yZCwgaXNTaWduVXApID0+IHtcbiAgICByZXR1cm4gKGRpc3BhdGNoKSA9PiB7XG4gICAgICAgIGRpc3BhdGNoKGF1dGhTdGFydCgpKTtcbiAgICAgICAgY29uc3QgYXV0aERhdGEgPSB7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQsXG4gICAgICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIGxldCB1cmwgPSAnaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vdjEvYWNjb3VudHM6c2lnblVwP2tleT1BSXphU3lCbkpvLWJCVk9aWmE0VF9TV1RkWXllclFQcWlPWUtJem8nO1xuICAgICAgICBpZiAoIWlzU2lnblVwKSB7XG4gICAgICAgICAgICB1cmwgPSAnaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vdjEvYWNjb3VudHM6c2lnbkluV2l0aFBhc3N3b3JkP2tleT1BSXphU3lCbkpvLWJCVk9aWmE0VF9TV1RkWXllclFQcWlPWUtJem8nO1xuICAgICAgICB9XG4gICAgICAgIGF4aW9zLnBvc3QodXJsLCBhdXRoRGF0YSlcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgcmVzcG9uc2UuZGF0YS5leHBpcmVzSW4gKiAxMDAwKTtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndG9rZW4nLCByZXNwb25zZS5kYXRhLmlkVG9rZW4pO1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdleHBpcmF0aW9uRGF0ZScsIGV4cGlyYXRpb25EYXRlKTtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndXNlcklkJywgcmVzcG9uc2UuZGF0YS5sb2NhbElkKTtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaChhdXRoU3VjY2VzcyhyZXNwb25zZS5kYXRhLmlkVG9rZW4sIHJlc3BvbnNlLmRhdGEubG9jYWxJZCkpO1xuICAgICAgICAgICAgICAgIGRpc3BhdGNoKGNoZWNrQXV0aFRpbWVvdXQocmVzcG9uc2UuZGF0YS5leHBpcmVzSW4pKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2goYXV0aEZhaWwoZXJyb3IucmVzcG9uc2UuZGF0YS5lcnJvcikpXG4gICAgICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3Qgc2V0QXV0aFJlZGlyZWN0UGF0aCA9IChwYXRoKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogYWN0aW9uVHlwZXMuU0VUX0FVVEhfUkVESVJFQ1RfUEFUSCxcbiAgICAgICAgcGF0aDogcGF0aFxuICAgIH07XG59O1xuXG5leHBvcnQgY29uc3QgYXV0aENoZWNrU3RhdGUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChkaXNwYXRjaCkgPT4ge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpO1xuICAgICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChsb2dvdXQoKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdleHBpcmF0aW9uRGF0ZScpKTtcbiAgICAgICAgICAgIGlmIChleHBpcmF0aW9uRGF0ZSA8PSBuZXcgRGF0ZSgpKSB7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2gobG9nb3V0KCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1c2VySWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcklkJyk7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2goYXV0aFN1Y2Nlc3ModG9rZW4sIHVzZXJJZCkpO1xuICAgICAgICAgICAgICAgIC8vIGdldHRpbmcgcmVtYWluaW5nIHRpbWVcbiAgICAgICAgICAgICAgICBkaXNwYXRjaChjaGVja0F1dGhUaW1lb3V0KChleHBpcmF0aW9uRGF0ZS5nZXRUaW1lKCkgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKSkgLyAxMDAwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59OyJdfQ==